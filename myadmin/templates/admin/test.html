<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Function Screenshot</title>

  <!-- Prism.js styling -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.css" rel="stylesheet" />

  <style>
    body {
      background: #ffffff;
      padding: 2rem;
      font-family: 'Segoe UI', sans-serif;
    }
    .code-container {
      max-width: 1000px;
      margin: auto;
    }
    h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    pre {
      border-radius: 6px;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <div class="code-container">
    <h2><code>monthly_dept_pdf</code> View Function</h2>
    <pre><code class="language-python">

@login_required
@user_passes_test(is_manager)
def monthly_dept_pdf(request, department_id):

    month = request.GET.get('month')
    if not month:
        return HttpResponse("No month provided")

    try:
        month = int(month)
    except ValueError:
        return HttpResponse("Invalid month")

    year = datetime.now().year
    department = Department.objects.get(id=department_id)

    leaves = Leave.objects.filter(
        employee__employee__department=department,
        posting_date__month=month,
        posting_date__year=year
    )

    template_path = 'admin/monthly_dept_report.html'
    context = {
        'department': department,
        'leaves': leaves,
        'month_label': f"{month}/{year}"
    }

    html = get_template(template_path).render(context)
    response = HttpResponse(content_type='application/pdf')
    pisa.CreatePDF(html, dest=response)
    return response
    </code></pre>
  </div>

  <!-- Prism.js scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</body>
</html>
