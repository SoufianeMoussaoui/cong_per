{% extends 'employee/main.html' %}
{% load static %}
{% block content %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
.container-card {
  width: 100%;
  margin: 0 auto;
  padding: 1.5rem;
  box-sizing: border-box;
}
.table-card { width: 100%; }
.header-row { display:flex; justify-content:space-between; align-items:center; gap:1rem; flex-wrap:wrap; }
.table-hover tbody tr:hover { background: rgba(13,110,253,0.04); }
.badge-status { font-size:.85rem; padding:.45em .6em; border-radius:.6rem; }
.no-data { padding:60px 0; color:#6c757d; }
@media (max-width:780px) {
  .header-row { flex-direction:column; align-items:stretch; }

}
td {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 240px; 
}

</style>

<div class="container-card mt-3">
  <div class="card shadow-sm table-card">
    <div class="card-body p-3">
      <div class="header-row mb-3">
        <h4 class="mb-0">Leave History</h4>
      </div>

      <div class="table-responsive">
        <table class="table table-borderless align-middle mb-0 table-hover">
          <thead class="small text-muted">
            <tr>
              <th>#</th>
              <th>Type</th>
              <th>Reason</th>
              <th>From</th>
              <th>To</th>
              <th>Applied</th>
              <th>Admin’s Remark</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for leave in leave_history %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ leave.leave_type.leavetype }}</td>
              <td title="{{ leave.comment }}">
  {% if leave.comment|length > 50 %}
    {{ leave.comment|slice:":50" }}...
  {% else %}
    {{ leave.comment }}
  {% endif %}
</td>

              <td>{{ leave.start_date }}</td>
              <td>{{ leave.end_date }}</td>
              <td>{{ leave.submission_date|date:"Y-m-d H:i" }}</td>
              <td>
                {% with last=leave.history.last %}
                  {% if last %}
                    {{ last.action }}{% if last.actor %} by {{ last.actor.username }}{% endif %}
                  {% else %}
                    —
                  {% endif %}
                {% endwith %}
              </td>
              <td>
                {% if leave.status == 'APPROVED' %}
                  <span class="badge bg-success badge-status">Approved</span>
                {% elif leave.status == 'DECLINED' %}
                  <span class="badge bg-danger badge-status">Declined</span>
                {% else %}
                  <span class="badge bg-warning text-dark badge-status">Pending</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="text-center no-data">
                <div>
                  <i class="fa fa-calendar-times fa-2x mb-2" aria-hidden="true"></i>
                  <div class="fw-semibold">No leave history</div>
                  <div class="small">You have not applied for any leave yet.</div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

{% include 'employee/footer.html' %}
{% endblock %}
